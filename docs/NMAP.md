# NMAP 探针匹配顺序(如RTSPRequest)

1. 探测与响应的直接匹配：

Nmap 会首先将收到的响应，与发送该探测包（在这里是 RTSPRequest）相关的 所有 match 规则进行比对。如果找到了一个完美的匹配（通常称为 硬匹配 或 hard match），Nmap 就会停止探测并报告结果。这是最高优先级的匹配。

2. fallback 探测匹配

如果 RTSPRequest 的响应没有找到直接匹配，Nmap 会使用一种 回退（fallback） 机制。nmap-service-probes 文件中的许多探测都定义了回退规则，以防万一。例如，RTSPRequest 探测通常有一个回退到 GetRequest 探测的规则。
这意味着，Nmap 会尝试用 GetRequest 探测的所有匹配规则，去匹配 RTSPRequest 收到的响应。这是因为许多基于流媒体或类似协议的服务，也可能对通用的 HTTP GET 请求做出响应，或者它们的响应格式与 HTTP 服务有相似之处。这种回退可以帮助 Nmap 识别那些运行在非标准端口上的 Web 服务，或者其他可能被错过的服务。

3. soft match (软匹配)

如果一个探测的响应只匹配到了服务类型（例如，匹配到 rtsp 服务），但无法确定具体的版本号，这被称为 软匹配。在这种情况下，Nmap 不会立即停止。它会记录下这个软匹配，并继续尝试发送其他与该服务类型相关的探测，希望能够得到更详细的响应，从而找到一个硬匹配。


4. version-intensity 和探测稀有度

version-intensity 参数控制 Nmap 在服务版本检测时的强度。较低的值（如 1）会减少探测的强度，而较高的值（如 9）会增加探测的强度。稀有度（rarity）参数则控制 Nmap 在选择探测时的稀有度。较低的稀有度（如 1）会选择更常见的探测，而较高的稀有度（如 9）会选择更稀有的探测。


总结一下，**Nmap 的匹配顺序遵循一个从 最特定到最通用 的原则：
首先，尝试将响应与发送它的探测（RTSPRequest）的指纹进行匹配。
如果失败，尝试将响应与回退探测（GetRequest）的指纹进行匹配。
如果仍然没有硬匹配，Nmap 会继续尝试其他探测，并根据稀有度级别逐步进行，直到找到最佳匹配或所有探测都失败**